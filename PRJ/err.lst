C51 COMPILER V9.00   ERR                                                                   04/13/2019 14:32:09 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE ERR
OBJECT MODULE PLACED IN ..\HEX\err.obj
COMPILER INVOKED BY: c:\Keil\C51\BIN\C51.EXE ..\SCR\err.c BROWSE INCDIR(..\INC) DEBUG OBJECTEXTEND PRINT(.\err.lst) TABS
                    -(2) OBJECT(..\HEX\err.obj)

line level    source

   1          /****************************************************************************
   2          * File:     ERR.c                           *
   3          * Created:    2015-02-13                          *
   4          * Last Change:                                *
   5          * Author:   chen zhi peng                         *
   6          * Description:                                *
   7          ****************************************************************************/
   8          #include "ERR.h"
   9          
  10          u8 xdata err;   //错误代码
  11          u8 xdata errnum;  //时钟
  12          u8 xdata errctr;  //错误计数
  13          
  14          
  15          void intErr()
  16          {
  17   1        err=ERR_INT;
  18   1        errnum=0;
  19   1        errctr=0;
  20   1      }
  21          void err_clk()
  22          {
  23   1        if ( errnum )
  24   1        {
  25   2          errnum--;
  26   2        }
  27   1      }
  28          
  29          void err_volu ( u8 dat )
  30          {
  31   1        if ( dat>=err )
  32   1        {
  33   2          err = dat;
  34   2          errctr++;
  35   2          errnum= ERRTIME;
  36   2        }
  37   1      }
  38          
  39          //********************************************************************************************************
             -****/
  40          //err_task
  41          //********************************************************************************************************
             -****/
  42          void err_task()
  43          {
  44   1        switch ( err )
  45   1        {
  46   2          case ERR_NONE:
  47   2            break;
  48   2          case ERR_CLR:
  49   2            Buzz_task ( BUZZ_NA );
  50   2            err=ERR_NONE;
  51   2            break;
  52   2      //************************************************************************//
C51 COMPILER V9.00   ERR                                                                   04/13/2019 14:32:09 PAGE 2   

  53   2      
  54   2      //************************************************单次提示鸣响******************//
  55   2          case ERR_INT:
  56   2            Buzz_task ( BUZZ_B );
  57   2            err=ERR_NONE;
  58   2            break;
  59   2          case ERR_M1S:
  60   2            Buzz_task ( BUZZ_B );
  61   2            err=ERR_NONE;
  62   2            break;
  63   2          case ERR_M18S:
  64   2          case ERR_EEPROM_WRITE:
  65   2            Buzz_task ( BUZZ_BB );
  66   2            err=ERR_NONE;
  67   2            break;
  68   2          case ERR_M38S:
  69   2          case ERR_EEPROM_WRITE1:
  70   2            Buzz_task ( BUZZ_BBB );
  71   2            err=ERR_NONE;
  72   2            break;
  73   2          case ERR_SPRI_BIG:
  74   2            Buzz_task ( BUZZ_BB_B_B_B );
  75   2            err=ERR_NONE;
  76   2            break;
  77   2          case ERR_SPRI_ERR:
  78   2            Buzz_task ( BUZZ_BB_BB );
  79   2            err=ERR_NONE;
  80   2            break;
  81   2          case ERR_SPRI_LIT:
  82   2            Buzz_task ( BUZZ_BB_B );
  83   2            err=ERR_NONE;
  84   2            break;
  85   2          case ERR_SPRI_MID:
  86   2            Buzz_task ( BUZZ_BB_B_B );
  87   2            err=ERR_NONE;
  88   2            break;
  89   2      //************************************************************************//
  90   2      
  91   2      //*************************************************5秒内提示鸣响******************//
  92   2          case ERR_UP_DRAG:       //抬闸遇阻
  93   2            Buzz_task ( BUZZ_B2 );
  94   2            if ( !errnum )
  95   2            {
  96   3              err= ERR_CLR;    //定时清除报警
  97   3            }
  98   2            break;
  99   2          case ERR_DW_DRAG:       //落闸遇阻
 100   2            Buzz_task ( BUZZ_B02 );
 101   2            if ( !errnum )
 102   2            {
 103   3              err= ERR_CLR;
 104   3            }
 105   2            break;
 106   2      //************************************************************************//
 107   2      
 108   2      //*************************************************故障持续提示鸣响*******//
 109   2          case ERR_ID_CONFLICT:
 110   2            Buzz_task ( BUZZ_B2 );
 111   2            break;
 112   2          case ERR_UP_FAIL:   //抬闸失败
 113   2            Buzz_task ( BUZZ_B_BB );
 114   2            break;
C51 COMPILER V9.00   ERR                                                                   04/13/2019 14:32:09 PAGE 3   

 115   2          case ERR_DW_FAIL:
 116   2            Buzz_task ( BUZZ_B_BBB );
 117   2            break;
 118   2          case ERR_US_FAIL:
 119   2            Buzz_task ( BUZZ_BB2 );
 120   2            break;
 121   2          case ERR_DS_FAIL:
 122   2            Buzz_task ( BUZZ_BBB2 );
 123   2            break;
 124   2          case ERR_POS_FAIL:
 125   2            Buzz_task ( BUZZ_B_B );
 126   2            break;
 127   2          default:
 128   2            err=ERR_CLR;
 129   2            break;
 130   2        }
 131   1        if ( err> ERR_LEV2 )
 132   1        {
 133   2          if ( !errctr )
 134   2          {
 135   3            err= ERR_CLR;    //无错误累加时，自动清除错误
 136   3          }
 137   2          else
 138   2          {
 139   3            errctr=0;
 140   3          }
 141   2        }
 142   1      
 143   1      }
 144          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    248    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      3    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
